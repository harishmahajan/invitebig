update users set email='' where email not like '%@invitebig.com' and email not like '%@test.com' and email not like 'titansgs%';
update booking_info set contact_email='' where contact_email not like '%@invitebig.com' and contact_email not like '%@test.com' and contact_email not like 'titansgs%';

DELETE FROM bookings;
DELETE FROM booking_addons;
DELETE FROM booking_adjustments;
DELETE FROM booking_info;
DELETE FROM booking_resources;
DELETE FROM booking_status;
DELETE FROM booking_messages;
DELETE FROM booking_payments;
DELETE FROM booking_promos;
DELETE FROM booking_menus;
DELETE FROM booking_menuitems;
DELETE FROM messages;
DELETE FROM messages_detail;
DELETE FROM payments;
DELETE FROM payments_status;


INSERT INTO addons_types (name) VALUES ('AV & Electronics');
INSERT INTO addons_types (name) VALUES ('Equipment & Tools');
INSERT INTO addons_types (name) VALUES ('Decor');
INSERT INTO addons_types (name) VALUES ('Furniture');
INSERT INTO addons_types (name) VALUES ('Other');
INSERT INTO menus_types (name) VALUES ('Appetizer');
INSERT INTO menus_types (name) VALUES ('Entree');
INSERT INTO menus_types (name) VALUES ('Dessert');
INSERT INTO menus_types (name) VALUES ('Non-Alcoholic Beverage');
INSERT INTO menus_types (name) VALUES ('Alcoholic Beverage');
INSERT INTO menus_types (name) VALUES ('Caterer');
INSERT INTO resources_types (name) VALUES ('Indoor Space');
INSERT INTO resources_types (name) VALUES ('Outdoor Space');
INSERT INTO resources_types (name) VALUES ('Seating');
INSERT INTO resources_types (name) VALUES ('Dining Table');
INSERT INTO resources_types (name) VALUES ('Pool Table');
INSERT INTO resources_types (name) VALUES ('Bowling Lane');
INSERT INTO venues_types (name) VALUES ('Bars and Nightclubs');
INSERT INTO venues_types (name) VALUES ('Concert and Music Halls');
INSERT INTO venues_types (name) VALUES ('Conference and Meeting Rooms');
INSERT INTO venues_types (name) VALUES ('Fun and Amusement Centers');
INSERT INTO venues_styles (name) VALUES ('venue_style_1');
INSERT INTO features (name) VALUES ('Free Parking');
INSERT INTO features (name) VALUES ('Valet Parking');
INSERT INTO features (name) VALUES ('Coat Check');
INSERT INTO features (name) VALUES ('Full Bar');
INSERT INTO features (name) VALUES ('WiFi Internet');
INSERT INTO features (name) VALUES ('Dance Floor');
INSERT INTO features (name) VALUES ('Family Friendly');
INSERT INTO features (name) VALUES ('Pool Table');
INSERT INTO features (name) VALUES ('Dart Board');
INSERT INTO features (name) VALUES ('Stage');
INSERT INTO features (name) VALUES ('Karaoke');

DROP DATABASE invitebig;
CREATE DATABASE invitebig;
GRANT ALL PRIVILEGES ON *.invitebig TO 'root'@'localhost' IDENTIFIED BY '';
USE invitebig;
CREATE TABLE addons (addonid INT AUTO_INCREMENT UNIQUE, venueid INT, typeid INT, name VARCHAR(128), description VARCHAR(2048), min INT, max INT, deposit_policyid INT, refund_policyid INT, price INT, status VARCHAR(32));
CREATE TABLE addons_hours (addonid INT, startminute INT, stopminute INT);
CREATE TABLE addons_photos (addonid INT, placement INT, photo VARCHAR(256), caption VARCHAR(1024));
CREATE TABLE addons_types (typeid INT AUTO_INCREMENT UNIQUE, name VARCHAR(64));
CREATE TABLE booking (bookingid INT AUTO_INCREMENT UNIQUE, venueid INT, eventid INT, userid INT, timestamp INT, start INT, stop INT, headcount INT, total_cost DECIMAL(9,2), total_deposit DECIMAL(9,2), refund VARCHAR(256), negotiationid INT, negotiation_complete BOOL, full_due INT, isnew INT, status VARCHAR(32));
CREATE TABLE booking_addons (bookingid INT, resourceid INT, addonid INT, quantity INT, cost DECIMAL(9,2), deliverat INT, refund_policyid INT);
CREATE TABLE booking_adjustments (bookingid INT, name VARCHAR(64), fee DECIMAL(9,2));
CREATE TABLE booking_files (fileid INT AUTO_INCREMENT UNIQUE, bookingid INT, userid INT, name VARCHAR(255), private BOOL, description VARCHAR(128), timestamp INT);
CREATE TABLE booking_info (bookingid INT, name VARCHAR(256), description VARCHAR(1024), comments VARCHAR(2048), contact_name VARCHAR(256), contact_company VARCHAR(256), contact_title VARCHAR(256), contact_phone VARCHAR(32), contact_email VARCHAR(256), contact_website VARCHAR(256));
CREATE TABLE booking_resources (bookingid INT, venueid INT, eventid INT, resourceid INT, starttime INT, stoptime INT, cost DECIMAL(9,2), cleanuptime INT, cleanupcost DECIMAL(9,2), isblocking BOOL, refund_policyid INT);
CREATE TABLE booking_status (bookingid INT, timestamp INT, status VARCHAR(32), changedby INT, notified INT);
CREATE TABLE booking_messages (bookingid INT, userid INT, timestamp INT, isvenue BOOL, message VARCHAR(2048), viewed_by_user BOOL, viewed_by_venue BOOL);
CREATE TABLE booking_payments (bookingid INT, paymentid INT);
CREATE TABLE booking_promos (bookingid INT, promoid INT, amount DECIMAL(9,2));
CREATE TABLE booking_menus (bookingid INT, menuindex INT AUTO_INCREMENT UNIQUE, menuid INT, cost DECIMAL(9,2), deliverat INT, refund_policyid INT);
CREATE TABLE booking_menuitems (bookingid INT, menuindex INT, itemid INT, quantity INT, cost DECIMAL(9,2));
CREATE TABLE deposit_policies (policyid INT AUTO_INCREMENT UNIQUE, venueid INT, name VARCHAR(128), deposit_dollar_thresh DECIMAL(9,2), deposit_perc INT, full_due INT);
CREATE TABLE events (eventid INT AUTO_INCREMENT UNIQUE, userid INT, venueid INT, timestamp INT, event_title VARCHAR(1024), event_description VARCHAR(8192), starttime INT, stoptime INT, selling_tickets BOOL, status VARCHAR(32));
CREATE TABLE events_rights (eventid INT, userid INT, grantedby INT, timestamp INT, role VARCHAR(32));
CREATE TABLE events_photos (eventid INT, placement INT, photo VARCHAR(256), caption VARCHAR(1024));
CREATE TABLE events_tickets (eventid INT, resourceid INT, over21_req BOOL, cost DECIMAL(9,2), description VARCHAR(2048), total_tickets INT, tickets_sold INT, refund_policyid INT);
CREATE TABLE features (featureid INT AUTO_INCREMENT UNIQUE, name VARCHAR(128));
CREATE TABLE guides (guideid INT PRIMARY KEY AUTO_INCREMENT, venueid INT, userid INT, name VARCHAR(32), timestamp INT, status VARCHAR(2048));
CREATE TABLE menus (menuid INT AUTO_INCREMENT UNIQUE, venueid INT, name VARCHAR(128), description VARCHAR(256), deposit_policyid INT, refund_policyid INT, status VARCHAR(32));
CREATE TABLE menus_hours (menuid INT, startminute INT, stopminute INT);
CREATE TABLE menus_items (itemid INT AUTO_INCREMENT UNIQUE, menuid INT, venueid INT, name VARCHAR(128), type INT, price DECIMAL(9,2), min INT, max INT, description VARCHAR(1024), photo VARCHAR(256), caption VARCHAR(1024), status VARCHAR(32));
CREATE TABLE menus_types (typeid INT AUTO_INCREMENT UNIQUE, name VARCHAR(32));
CREATE TABLE messages (convoid INT AUTO_INCREMENT UNIQUE, deletedu INT, deletedv INT, type INT, userid INT, venueid INT, newforu INT, newforv INT, title VARCHAR(256));
CREATE TABLE messages_detail (messageid INT AUTO_INCREMENT UNIQUE, convoid INT, timestamp INT, message VARCHAR(4096));
CREATE TABLE negotiations (negotiationid INT AUTO_INCREMENT UNIQUE, timestamp INT, userid INT, promo INT, comments VARCHAR(2048), venue_acceptedid INT, useraccepted BOOL);
CREATE TABLE payments (paymentid INT AUTO_INCREMENT UNIQUE, userid INT, payment_method VARCHAR(32), chargeid VARCHAR(32), timestamp INT, name VARCHAR(256), last4 VARCHAR(4), amount DECIMAL(9,2), currency CHAR(3), status VARCHAR(32));
CREATE TABLE payments_status (paymentid INT, userid INT, timestamp INT, status VARCHAR(128));
CREATE TABLE personnel (personnelid INT AUTO_INCREMENT UNIQUE, venueid INT, name VARCHAR(255), description VARCHAR(2048), price DECIMAL(9,2), min INT, max INT, req INT, deposit_policyid INT, refund_policyid INT, status VARCHAR(32))
CREATE TABLE personnel_hours (personnelid INT, startminute INT, stopminute INT);
CREATE TABLE personnel_resources (personnelid INT, resourceid INT);
CREATE TABLE promos (promoid INT AUTO_INCREMENT UNIQUE, venueid INT, lastmodified DATETIME, name VARCHAR(256), description VARCHAR(1024), dollar_threshold DECIMAL(9,2), dollar_discount DECIMAL(9,2), percentage_discount INT, reuses INT, quantity INT, inherit INT, entireinvoice INT, combinable INT, starttime INT, stoptime INT, status VARCHAR(32));
CREATE TABLE promos_hours (promoid INT, start INT, stop INT);
CREATE TABLE promos_resources (promoid INT, resourceid INT);
CREATE TABLE booking_questions (bookingid INT, questionid INT, answer INT);
CREATE TABLE booking_questions_text (bookingid INT, questionid INT, answer VARCHAR(1024));
CREATE TABLE questions (questionid INT AUTO_INCREMENT UNIQUE, venueid INT, deleted BOOL, question VARCHAR(1024), `type` VARCHAR(16), req BOOL);
CREATE TABLE questions_choices (questionid INT, choiceid INT AUTO_INCREMENT UNIQUE, choice VARCHAR(1024));
CREATE TABLE questions_addons (questionid INT, addonid INT);
CREATE TABLE questions_menus (questionid INT, menuid INT);
CREATE TABLE questions_personnel (questionid INT, personnelid INT);
CREATE TABLE questions_resources (questionid INT, resourceid INT);
CREATE TABLE resources (resourceid INT AUTO_INCREMENT UNIQUE, venueid INT, typeid INT, name VARCHAR(128), autoapprove BOOL, deposit_policyid INT, refund_policyid INT, over21_req BOOL, capacity INT, seats INT, timeslots INT, minduration INT, min_lead_time INT, cleanupcost DECIMAL(9,2), cleanuptime INT, description VARCHAR(2048), default_rate DECIMAL(9,2), status VARCHAR(32));
CREATE TABLE resources_relationships (childid INT, parentid INT, relation VARCHAR(32));
CREATE TABLE resources_addons (resourceid INT, addonid INT);
CREATE TABLE resources_photos (resourceid INT, placement INT, photo VARCHAR(256), caption VARCHAR(1024));
CREATE TABLE resources_hours (resourceid INT, startminute INT, stopminute INT);
CREATE TABLE refund_policies (policyid INT AUTO_INCREMENT UNIQUE, venueid INT, name VARCHAR(128), policy VARCHAR(256));
CREATE TABLE resources_rates(resourceid INT, startminute INT, stopminute INT, rate DECIMAL(9,2));
CREATE TABLE resources_rates_raw(resourceid INT, startminute INT, stopminute INT, rate DECIMAL(9,2));
CREATE TABLE resources_rate_exceptions (resourceid INT, starttime INT, stoptime INT, rate DECIMAL(9,2));
CREATE TABLE resources_slots(resourceid INT, startminute INT, stopminute INT, rate DECIMAL(9,2), combinable INT);
CREATE TABLE resources_types (typeid INT AUTO_INCREMENT UNIQUE, name VARCHAR(32));
CREATE TABLE signatures (userid INT, contract VARCHAR(255), timestamp INT);
CREATE TABLE subscription_cancel (venueid INT, reason VARCHAR(2048), timestamp INT);
CREATE TABLE tickets (ticketid INT AUTO_INCREMENT UNIQUE, eventid INT, resourceid INT, userid INT, timestamp INT, cost DECIMAL(9,2), firstname VARCHAR(128), lastname VARCHAR(128), paymentid INT, refund_policy VARCHAR(256));
CREATE TABLE tickets_status (ticketid INT, uniqueid NCHAR(15), timestamp INT, status VARCHAR(32), changedby INT);
CREATE TABLE tickets_payments (ticketid INT, userid INT, paymentid INT, timestamp INT, amount DECIMAL(9,2));
CREATE TABLE tickets_photos (eventid INT, resourceid INT, placement INT, photo VARCHAR(256), caption VARCHAR(1024));
CREATE TABLE users (userid INT AUTO_INCREMENT UNIQUE, fbid VARCHAR(32), gid VARCHAR(32), timestamp INT, email VARCHAR(256), password VARCHAR(256), lastlogin INT, firstname VARCHAR(128), lastname VARCHAR(128), birthdate DATE, phone VARCHAR(64), isverified BOOL, code VARCHAR(32), role VARCHAR(32), timezone VARCHAR(64), receive_Promotions BOOL, receive_updates BOOL);
CREATE TABLE venues (venueid INT AUTO_INCREMENT UNIQUE, timestamp INT, mod_timestamp INT, timezone VARCHAR(128), userid INT, venue_typeid INT, venue_styleid INT, shorturl VARCHAR(128), searchstring VARCHAR(256), name VARCHAR(128), description VARCHAR(8192), website VARCHAR(256), facebook VARCHAR(256), twitter VARCHAR(256), business_name VARCHAR(128), address VARCHAR(128), zip VARCHAR(16), city VARCHAR(64), state VARCHAR(64), latitude VARCHAR(16), longitude VARCHAR(16), phone VARCHAR(16), salestax DECIMAL(9,2), currency CHAR(3), bookingfee DECIMAL(8,3), processingfee DECIMAL(8,3), contract VARCHAR(256), status VARCHAR(32));
CREATE TABLE venues_contacts (venueid INT, name VARCHAR(128), title VARCHAR(128), phone VARCHAR(16), email VARCHAR(256), comments VARCHAR(1024));
CREATE TABLE venues_promos (venueid INT, name VARCHAR(256), resource_type1 INT, resource_type2 INT, resource_type3 INT, resource_type4 INT, startminute INT, stopminute INT, promo_perc INT);
CREATE TABLE venues_features (venueid INT, featureid INT, description VARCHAR(2048));
CREATE TABLE venues_functionality (venueid INT, showMenus INT, showPersonnel INT, showQuestions INT, showPromos INT, publicFileUploads INT, gratuity INT);
CREATE TABLE venues_photos (photoid INT, venueid INT, placement INT, photo VARCHAR(256), caption VARCHAR(1024));
CREATE TABLE venues_rights (venueid INT, email VARCHAR(256), grantedby INT, timestamp INT, role VARCHAR(32));
CREATE TABLE venues_subscriptions (venueid INT, customerid VARCHAR(32), subid VARCHAR(32), status VARCHAR(32));
CREATE TABLE venues_styles (styleid INT AUTO_INCREMENT UNIQUE, name VARCHAR(32));
CREATE TABLE venues_types (typeid INT AUTO_INCREMENT UNIQUE, name VARCHAR(32));
CREATE TABLE venues_reviews (venueid INT, userid INT, timestamp INT, bookingid INT, stars INT, comments VARCHAR(2048));

ALTER TABLE addons ADD PRIMARY KEY(addonid), ADD INDEX(venueid), ADD INDEX(typeid), ADD INDEX(status);
ALTER TABLE addons_hours ADD INDEX(addonid);
ALTER TABLE addons_photos ADD INDEX(addonid, placement);
ALTER TABLE addons_types ADD INDEX(typeid);
ALTER TABLE booking ADD PRIMARY KEY(bookingid), ADD INDEX(eventid), ADD INDEX(venueid), ADD INDEX(userid), ADD INDEX(isnew), ADD INDEX(status);
ALTER TABLE booking_addons ADD INDEX(bookingid), ADD INDEX(addonid);
ALTER TABLE booking_adjustments ADD INDEX(bookingid);
ALTER TABLE booking_files ADD INDEX(bookingid), ADD INDEX(fileid);
ALTER TABLE booking_info ADD INDEX(bookingid);
ALTER TABLE booking_menuitems ADD INDEX(bookingid);
ALTER TABLE booking_menus ADD INDEX(bookingid), ADD INDEX(menuindex);
ALTER TABLE booking_personnel ADD INDEX(bookingid),ADD INDEX(personnelid);
ALTER TABLE booking_promos ADD INDEX(bookingid), ADD INDEX(promoid);
ALTER TABLE booking_resources ADD INDEX(bookingid), ADD INDEX(venueid), ADD INDEX(resourceid);
ALTER TABLE booking_status ADD INDEX(bookingid);
ALTER TABLE booking_messages ADD INDEX(bookingid), ADD INDEX(userid);
ALTER TABLE booking_payments ADD INDEX(bookingid), ADD INDEX(paymentid);
ALTER TABLE booking_questions ADD INDEX(bookingid), ADD INDEX(questionid);
ALTER TABLE deposit_policies ADD PRIMARY KEY(policyid), ADD INDEX(venueid);
ALTER TABLE events ADD PRIMARY KEY(eventid), ADD INDEX(userid), ADD INDEX(venueid);
ALTER TABLE events_rights ADD INDEX(eventid), ADD INDEX(userid);
ALTER TABLE events_photos ADD INDEX(eventid);
ALTER TABLE events_tickets ADD INDEX(eventid);
ALTER TABLE features ADD PRIMARY KEY(featureid);
ALTER TABLE guides ADD INDEX(name), ADD INDEX(venueid), ADD INDEX(userid);
ALTER TABLE menus ADD PRIMARY KEY(menuid), ADD INDEX(venueid), ADD INDEX(status);
ALTER TABLE menus_hours ADD INDEX(menuid);
ALTER TABLE menus_items ADD INDEX(menuid), ADD INDEX(itemid), ADD INDEX(venueid), ADD INDEX(status);
ALTER TABLE menus_types ADD INDEX(typeid);
ALTER TABLE messages ADD INDEX(convoid), ADD INDEX(userid), ADD INDEX(venueid), ADD INDEX(deletedu), ADD INDEX(deletedv);
ALTER TABLE messages_detail ADD PRIMARY KEY(messageid), ADD INDEX(convoid);

ALTER TABLE payments ADD PRIMARY KEY(paymentid),ADD INDEX(userid);
ALTER TABLE payments_status ADD INDEX(paymentid), ADD INDEX(status);
ALTER TABLE personnel ADD PRIMARY KEY(personnelid), ADD INDEX(venueid), ADD INDEX(status);
ALTER TABLE personnel_hours ADD INDEX(personnelid);
ALTER TABLE personnel_resources ADD INDEX(personnelid), ADD INDEX(resourceid);
ALTER TABLE promos ADD PRIMARY KEY(promoid), ADD INDEX(venueid);
ALTER TABLE promos_hours ADD INDEX(promoid);
ALTER TABLE promos_resources ADD INDEX(promoid), ADD INDEX(resourceid);
ALTER TABLE questions ADD PRIMARY KEY(questionid), ADD INDEX(venueid);
ALTER TABLE questions_choices ADD INDEX(questionid), ADD INDEX(choiceid);
ALTER TABLE questions_addons ADD INDEX(questionid), ADD INDEX(addonid);
ALTER TABLE questions_menus ADD INDEX(questionid), ADD INDEX(menuid);
ALTER TABLE questions_personnel ADD INDEX(questionid), ADD INDEX(personnelid);
ALTER TABLE questions_resources ADD INDEX(questionid), ADD INDEX(resourceid);
ALTER TABLE resources ADD PRIMARY KEY(resourceid), ADD INDEX(venueid), ADD INDEX(typeid), ADD INDEX(status);
ALTER TABLE resources_relationships ADD INDEX(childid), ADD INDEX(parentid);
ALTER TABLE resources_addons ADD INDEX(resourceid);
ALTER TABLE resources_photos ADD INDEX(resourceid);
ALTER TABLE resources_hours ADD INDEX(resourceid);
ALTER TABLE refund_policies ADD PRIMARY KEY(policyid), ADD INDEX(venueid);
ALTER TABLE resources_rates ADD INDEX(resourceid);
ALTER TABLE resources_rates_raw ADD INDEX(resourceid);
ALTER TABLE resources_rate_exceptions ADD INDEX(resourceid);
ALTER TABLE resources_slots ADD INDEX(resourceid);
ALTER TABLE resources_types ADD INDEX(typeid);
ALTER TABLE signatures ADD INDEX(userid), ADD INDEX(contract);
ALTER TABLE subscription_cancel ADD INDEX(venueid);
ALTER TABLE tickets ADD PRIMARY KEY(ticketid), ADD INDEX(eventid), ADD INDEX(userid);
ALTER TABLE tickets_status ADD INDEX(ticketid), ADD INDEX(uniqueid);
ALTER TABLE tickets_payments ADD INDEX(ticketid), ADD INDEX(userid), ADD INDEX(paymentid);
ALTER TABLE tickets_photos ADD INDEX(eventid), ADD INDEX(resourceid);
ALTER TABLE users ADD PRIMARY KEY(userid), ADD PRIMARY KEY(fbid), ADD PRIMARY KEY(gid), ADD PRIMARY KEY(email);
ALTER TABLE venues ADD PRIMARY KEY(venueid), ADD INDEX(venue_typeid), ADD INDEX(venue_styleid), ADD INDEX(status), ADD INDEX(visibility), ADD INDEX(shorturl);
ALTER TABLE venues_contacts ADD INDEX(venueid);
ALTER TABLE venues_features ADD INDEX(venueid), ADD INDEX(featureid);
ALTER TABLE venues_functionality ADD INDEX(venueid);
ALTER TABLE venues_photos ADD INDEX(venueid);
ALTER TABLE venues_rights ADD INDEX(venueid),ADD INDEX(email);
ALTER TABLE venues_subscriptions ADD INDEX(venueid);
ALTER TABLE venues_styles ADD INDEX(styleid);
ALTER TABLE venues_types ADD INDEX(typeid);
ALTER TABLE venues_reviews ADD INDEX(venueid);

ALTER TABLE addons ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE addons_hours ADD FOREIGN KEY (addonid) REFERENCES addons(addonid) ON DELETE CASCADE FOR addonid;
ALTER TABLE addons_photos ADD FOREIGN KEY (addonid) REFERENCES addons(addonid) ON DELETE CASCADE;
ALTER TABLE booking ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE booking ADD FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE;
ALTER TABLE booking_addons ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_adjustments ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_files ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_info ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_menuitems ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_menus ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_messages ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_payments ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_payments ADD FOREIGN KEY (paymentid) REFERENCES payments(paymentid) ON DELETE CASCADE;
ALTER TABLE booking_personnel ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_promos ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_questions ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_resources ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE booking_status ADD FOREIGN KEY (bookingid) REFERENCES booking(bookingid) ON DELETE CASCADE;
ALTER TABLE deposit_policies ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE events_photos ADD FOREIGN KEY (eventid) REFERENCES events(eventid) ON DELETE CASCADE;
ALTER TABLE events_rights ADD FOREIGN KEY (eventid) REFERENCES events(eventid) ON DELETE CASCADE;
ALTER TABLE events_tickets ADD FOREIGN KEY (eventid) REFERENCES events(eventid) ON DELETE CASCADE;
ALTER TABLE menus ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE menus_hours ADD FOREIGN KEY (menuid) REFERENCES menus(menuid) ON DELETE CASCADE;
ALTER TABLE menus_items ADD FOREIGN KEY (menuid) REFERENCES menus(menuid) ON DELETE CASCADE;
ALTER TABLE messages ADD FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE;
ALTER TABLE messages ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE messages_detail ADD FOREIGN KEY (convoid) REFERENCES messages(convoid) ON DELETE CASCADE;
ALTER TABLE payments ADD FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE;
ALTER TABLE payments_status ADD FOREIGN KEY (paymentid) REFERENCES payments(paymentid) ON DELETE CASCADE;
ALTER TABLE personnel ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE personnel_hours ADD FOREIGN KEY (personnelid) REFERENCES personnel(personnelid) ON DELETE CASCADE;
ALTER TABLE personnel_resources ADD FOREIGN KEY (personnelid) REFERENCES personnel(personnelid) ON DELETE CASCADE;
ALTER TABLE promos ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE promos_hours ADD FOREIGN KEY (promoid) REFERENCES promos(promoid) ON DELETE CASCADE;
ALTER TABLE promos_resources ADD FOREIGN KEY (promoid) REFERENCES promos(promoid) ON DELETE CASCADE;
ALTER TABLE promos_resources ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE questions ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE questions_addons ADD FOREIGN KEY (questionid) REFERENCES questions(questionid) ON DELETE CASCADE;
ALTER TABLE questions_choices ADD FOREIGN KEY (questionid) REFERENCES questions(questionid) ON DELETE CASCADE;
ALTER TABLE questions_menus ADD FOREIGN KEY (questionid) REFERENCES questions(questionid) ON DELETE CASCADE;
ALTER TABLE questions_personnel ADD FOREIGN KEY (questionid) REFERENCES questions(questionid) ON DELETE CASCADE;
ALTER TABLE questions_resources ADD FOREIGN KEY (questionid) REFERENCES questions(questionid) ON DELETE CASCADE;
ALTER TABLE refund_policies ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE resources ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE resources_addons ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_hours ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_photos ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_rates ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_rates_raw ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_rate_exceptions ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_relationships ADD FOREIGN KEY (childid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_relationships ADD FOREIGN KEY (parentid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_slots ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE resources_addons ADD FOREIGN KEY (resourceid) REFERENCES resources(resourceid) ON DELETE CASCADE;
ALTER TABLE signatures ADD FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE;
ALTER TABLE tickets ADD FOREIGN KEY (eventid) REFERENCES events(eventid) ON DELETE CASCADE;
ALTER TABLE tickets ADD FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE;
ALTER TABLE tickets_payments ADD FOREIGN KEY (ticketid) REFERENCES tickets(ticketid) ON DELETE CASCADE;
ALTER TABLE tickets_status ADD FOREIGN KEY (ticketid) REFERENCES tickets(ticketid) ON DELETE CASCADE;
ALTER TABLE venues_contacts ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_features ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_functionality ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_photos ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_reviews ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_rights ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_subscriptions ADD FOREIGN KEY (venueid) REFERENCES venues(venueid) ON DELETE CASCADE;
ALTER TABLE venues_features ADD FOREIGN KEY (featureid) REFERENCES features(featureid) ON DELETE CASCADE;


--------- Fix the shorturls and searchstrings ---------------
UPDATE venues SET shorturl = LOWER(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CONCAT(name,' ',city),'|',''),'&',''),'''',''),' ','-'),'--','-'),'--','-')) WHERE venueid not in (1,76)

UPDATE venues v join venues_types t on t.typeid=v.venue_typeid
	SET searchstring = LOWER(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CONCAT(city,'-',state,'/',t.name,'/',shorturl),'|',''),'&',''),'''',''),' ','-'),'--','-'),'--','-'));
	
